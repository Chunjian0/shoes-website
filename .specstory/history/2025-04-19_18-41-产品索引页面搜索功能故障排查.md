## SpecStory

## 产品索引页面搜索功能故障排查 (4/19/2025, 6:41:06 PM)

_**User**_

@ProductController.php  目前我的http://localhost:2268/products index页面搜索功能失效了 帮我检查一下为什么

---

_**Assistant**_



---

_****_

好的，我们来检查一下 `ProductController.php` 中 `index` 方法的搜索功能为什么会失效。

**分析 `ProductController.php` 的 `index` 方法：**

1.  **获取搜索词**: 代码通过 `$search = $request->input('search');` 正确获取名为 `search` 的查询参数。
2.  **应用搜索条件**:
    *   当 `$search` 存在时，代码使用 `if ($search)` 条件块来添加搜索逻辑。
    *   使用了 `where(function($q) use ($search) { ... })` 来正确地将多个 `orWhere` 条件分组，避免与其他过滤条件（如 `category_id`）冲突。
    *   搜索逻辑是 `$q->where('name', 'like', "%{$search}%")->orWhere('sku', 'like', "%{$search}%")->orWhere('description', 'like', "%{$search}%");`，这看起来是正确的，它会在 `name`、`sku` 和 `description` 字段中进行模糊匹配。
3.  **其他过滤和排序**: 代码也处理了分类、SKU、品牌、型号等过滤条件以及排序，这些逻辑看起来与搜索逻辑是分开处理的，应该不会直接冲突。
4.  **特殊链接参数**: 代码包含处理 `link_template` 相关参数的逻辑，但这部分逻辑是在标准搜索逻辑之前检查的。如果 URL 中 *不* 包含这些特殊参数，代码会继续执行标准的搜索和过滤流程。
5.  **分页和视图返回**: 查询构建完毕后，使用 `$query->paginate(10)->appends($request->except('page'));` 进行分页，并将包括 `$search` 在内的所有参数传递给视图 `products.index`。

**初步结论:**

从 `ProductController.php` 的代码来看，处理 `search` 参数的后端逻辑是**正确**的。搜索失效的原因更可能存在于：

1.  **前端视图 (`resources/views/products/index.blade.php`)**:
    *   搜索表单的 `input` 字段可能没有设置 `name="search"`。
    *   表单的提交方法 (`method`) 可能不是 `GET`。
    *   如果页面使用了 JavaScript 或 Livewire 来处理搜索（例如，无刷新搜索），那么可能是 JavaScript 代码未能正确地将 `search` 参数附加到请求 URL 上，或者 Livewire 组件未能正确更新其状态并重新查询数据。鉴于你的自定义指令提到了 Livewire 问题，这一点尤其值得怀疑。
2.  **URL 问题**: 在进行搜索时，URL 中是否意外地包含了 `link_template` 或其他特殊参数？这会导致控制器执行不同的逻辑分支。
3.  **数据问题**: 数据库中确实存在与你搜索词匹配的产品吗？

**下一步:**

为了进一步诊断，我需要查看前端代码。你能否提供 `resources/views/products/index.blade.php` 文件中与搜索表单相关的部分代码吗？特别是包含 `<form>` 标签和带有 `name="search"` 的 `<input>` 元素的部分。

---

_**User**_

你可以直接搜索和查看文件然后帮我限制一下这个表每一格的长度避免有滑动条 然后美化一下切换显示页数的按钮

---

_**Assistant**_



---

_****_

好的，我们来处理产品列表页面的搜索功能、表格样式和分页按钮美化。

**计划：**

1.  **查找并分析视图文件**：找到 `products.index` 对应的 Blade 视图文件，检查搜索表单的实现方式。
2.  **修复搜索功能**：根据视图文件的内容，确定搜索失效的原因（可能是表单配置错误、JavaScript 问题或 Livewire 组件问题）并进行修复。
3.  **调整表格列宽**：修改视图文件，为表格单元格（尤其是显示产品名称/SKU 的列）添加 CSS 类（使用 Tailwind CSS），限制其最大宽度并处理文本溢出，防止出现水平滚动条。
4.  **美化分页按钮**：修改视图文件或相关的分页视图模板，使用 Tailwind CSS 美化分页链接的样式，使其与页面整体风格更协调。

**步骤：**

1.  **查找视图文件**
    我将先搜索 `products/index.blade.php` 文件。
    

---

_****_

<details>
            <summary>Searched codebase "products/index.blade.php" • **3** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

_****_

2.  **读取视图文件内容**
    文件找到了，现在我来读取 `resources/views/products/index.blade.php` 的内容，分析搜索表单、表格和分页部分。
    

---

_****_

Read file: undefined

---

_****_



---

_****_

Read file: undefined

---

_****_

好的，我已经查看了 `resources/views/products/index.blade.php` 的部分内容。

**发现：**

1.  **搜索功能问题**:
    *   视图中确实有一个搜索输入框，但它的 `id` 是 `frontend-search`，**没有 `name` 属性**。
    *   这个输入框没有包含在任何 `<form>` 标签内。
    *   页面底部有大量的 JavaScript 代码，特别是 `setupProductFiltering()` 函数和 `frontend-search`、`frontend-category` 等 ID 选择器，这强烈暗示**搜索和过滤功能是由前端 JavaScript 实现的，而不是通过传统的表单提交到后端的 `ProductController@index` 方法处理的**。
    *   **结论**：后端的 `ProductController@index` 方法中的 `$search` 逻辑实际上没有被使用。搜索功能失效是因为前端 JavaScript 代码存在问题或未完全实现。截图显示输入 "sdf" 后列表没有变化，也印证了这一点。

2.  **表格列宽**:
    *   表格 (`<table class="min-w-full divide-y divide-gray-200">`) 结构存在。
    *   “Product” 列的 `<td>` 包含产品名称、SKU 和条形码，目前没有设置最大宽度或文本截断。

3.  **分页按钮**:
    *   使用了标准的 Laravel 分页链接：`{{ $products->withQueryString()->links() }}`。这通常会渲染默认的分页视图。

**解决方案：**

由于搜索是由前端 JavaScript 处理的，修复它需要检查和修改相关的 JS 代码。同时，我们可以应用样式来限制列宽和美化分页。

我将进行以下修改：

1.  **表格样式**: 为“Product”列的 `<td>` 添加 `max-w-xs` (或根据需要调整) 和 `truncate` 类来限制宽度并显示省略号。
2.  **分页样式**: 通过直接在 `index.blade.php` 中添加一些 CSS 规则来覆盖默认的分页样式，使其更美观（这是一个快速修复，更彻底的方法是发布和修改分页视图）。
3.  **前端搜索 (初步修复)**:
    *   为搜索输入框添加 `name="search"` 属性，并将其包含在一个 `GET` 方法的表单中，使其能够回退到后端搜索（虽然主要依赖 JS，但这是个好习惯）。
    *   在 `setupProductFiltering` 函数中添加基本的日志记录，以便在浏览器控制台中观察其行为。 **注意**: 这可能无法完全修复前端搜索，因为 JS 逻辑可能更复杂，但这可以提供调试线索。

我现在将应用这些修改。


---

_****_

```diff
          <!-- Search and screen -->
          <div class="mb-6">
-             <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
-                 <div>
-                     <label for="frontend-search" class="block text-sm font-medium text-gray-700">Search</label>
-                     <input type="text" id="frontend-search" 
-                            class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
-                            placeholder="Product name/SKU/Barcode">
-                 </div>
-                 <div>
-                     <label for="frontend-category" class="block text-sm font-medium text-gray-700">Category</label>
-                     <select id="frontend-category" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
-                         <option value="">All Categories</option>
-                         @foreach($categories as $category)
-                             <option value="{{ $category->id }}">
-                                 {{ $category->name }}
-                             </option>
-                         @endforeach
-                     </select>
-                 </div>
-                 <div>
-                     <label for="frontend-status" class="block text-sm font-medium text-gray-700">Status</label>
-                     <select id="frontend-status" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
-                         <option value="">All Statuses</option>
-                         <option value="1">Active</option>
-                         <option value="0">Inactive</option>
-                     </select>
-                 </div>
-                 <div>
-                     <label for="frontend-stock-status" class="block text-sm font-medium text-gray-700">Stock Status</label>
-                     <select id="frontend-stock-status" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
-                         <option value="">All</option>
-                         <option value="sufficient">Sufficient Stock</option>
-                         <option value="low">Low Stock</option>
-                         <option value="out">Out of Stock</option>
-                     </select>
-                 </div>
-             </div>
+             <form method="GET" action="{{ route('products.index') }}" id="filter-form">
+                 <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
+                     <div>
+                         <label for="frontend-search" class="block text-sm font-medium text-gray-700">Search</label>
+                         <input type="text" id="frontend-search" name="search" 
+                                value="{{ request('search') }}"
+                                class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
+                                placeholder="Product name/SKU/Barcode">
+                     </div>
+                     <div>
+                         <label for="frontend-category" class="block text-sm font-medium text-gray-700">Category</label>
+                         <select id="frontend-category" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
+                             <option value="">All Categories</option>
+                             @foreach($categories as $category)
+                                 <option value="{{ $category->id }}">
+                                     {{ $category->name }}
+                                 </option>
+                             @endforeach
+                         </select>
+                     </div>
+                     <div>
+                         <label for="frontend-status" class="block text-sm font-medium text-gray-700">Status</label>
+                         <select id="frontend-status" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
+                             <option value="">All Statuses</option>
+                             <option value="1">Active</option>
+                             <option value="0">Inactive</option>
+                         </select>
+                     </div>
+                     <div>
+                         <label for="frontend-stock-status" class="block text-sm font-medium text-gray-700">Stock Status</label>
+                         <select id="frontend-stock-status" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
+                             <option value="">All</option>
+                             <option value="sufficient">Sufficient Stock</option>
+                             <option value="low">Low Stock</option>
+                             <option value="out">Out of Stock</option>
+                         </select>
+                     </div>
+                 </div>
+                 <button type="submit" class="hidden">Apply Filters</button>
+             </form>
          </div>
  
                                          data-status="{{ $product->is_active ? '1' : '0' }}"
                                          data-stock-status="{{ ($product->inventory_count ?? 0) > $product->min_stock ? 'sufficient' : (($product->inventory_count ?? 0) > 0 ? 'low' : 'out') }}">
-                                         <td class="px-6 py-4 whitespace-nowrap">
+                                         <td class="px-6 py-4 whitespace-nowrap max-w-xs truncate">
                                              <div class="flex items-center">
                                                  @if($product->images && count($product->images) > 0)
  </div>
  @endsection 
+ 
+ @push('styles')
+ <style>
+     /* Basic Pagination Styling */
+     .pagination {
+         display: flex;
+         justify-content: center;
+         align-items: center;
+         padding: 1rem 0;
+     }
+     .pagination span,
+     .pagination a {
+         padding: 0.5rem 0.75rem;
+         margin: 0 0.25rem;
+         border-radius: 0.375rem; /* rounded-md */
+         font-size: 0.875rem; /* text-sm */
+         line-height: 1.25rem;
+         text-decoration: none;
+     }
+     .pagination span.disabled {
+         color: #9ca3af; /* text-gray-400 */
+         background-color: #f3f4f6; /* bg-gray-100 */
+         cursor: not-allowed;
+     }
+     .pagination a {
+         color: #4f46e5; /* text-indigo-600 */
+         background-color: #ffffff; /* bg-white */
+         border: 1px solid #e5e7eb; /* border-gray-200 */
+         transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
+     }
+     .pagination a:hover {
+         background-color: #eef2ff; /* hover:bg-indigo-50 */
+         color: #4338ca; /* hover:text-indigo-700 */
+     }
+     .pagination .active span {
+         background-color: #4f46e5; /* bg-indigo-600 */
+         color: #ffffff; /* text-white */
+         border-color: #4f46e5; /* border-indigo-600 */
+     }
+ </style>
+ @endpush
  
  @push('scripts')
      function setupProductFiltering() {
          // 实现前端筛选
-         console.log('Setting up product filtering');
+         console.log('Setting up product filtering. This function needs implementation.');
+         const searchInput = document.getElementById('frontend-search');
+         const categorySelect = document.getElementById('frontend-category');
+         const statusSelect = document.getElementById('frontend-status');
+         const stockSelect = document.getElementById('frontend-stock-status');
+         const tableBody = document.getElementById('products-table-body');
+         const noResultsRow = document.getElementById('no-products-row');
+         const allRows = tableBody ? Array.from(tableBody.querySelectorAll('tr.product-row')) : [];
+ 
+         function applyFilters() {
+             const searchTerm = searchInput.value.toLowerCase();
+             const categoryId = categorySelect.value;
+             const status = statusSelect.value;
+             const stockStatus = stockSelect.value;
+             let visibleCount = 0;
+ 
+             console.log('Applying filters:', { searchTerm, categoryId, status, stockStatus });
+ 
+             allRows.forEach(row => {
+                 const name = row.dataset.name || '';
+                 const sku = row.dataset.sku || '';
+                 const barcode = row.dataset.barcode || '';
+                 const rowCategory = row.dataset.category || '';
+                 const rowStatus = row.dataset.status || '';
+                 const rowStock = row.dataset.stockStatus || '';
+ 
+                 const searchMatch = searchTerm === '' || name.includes(searchTerm) || sku.includes(searchTerm) || barcode.includes(searchTerm);
+                 const categoryMatch = categoryId === '' || rowCategory === categoryId;
+                 const statusMatch = status === '' || rowStatus === status;
+                 const stockMatch = stockStatus === '' || rowStock === stockStatus;
+ 
+                 if (searchMatch && categoryMatch && statusMatch && stockMatch) {
+                     row.style.display = '';
+                     visibleCount++;
+                 } else {
+                     row.style.display = 'none';
+                 }
+             });
+ 
+             if (noResultsRow) {
+                  noResultsRow.style.display = visibleCount === 0 ? '' : 'none';
+             }
+              console.log(`${visibleCount} products visible after filtering.`);
+         }
+ 
+         if (searchInput) searchInput.addEventListener('input', applyFilters);
+         if (categorySelect) categorySelect.addEventListener('change', applyFilters);
+         if (statusSelect) statusSelect.addEventListener('change', applyFilters);
+         if (stockSelect) stockSelect.addEventListener('change', applyFilters);
+ 
+         // Initial filter application on load if needed
+          applyFilters(); // Apply filters once on page load based on initial values
      }
  
```

---

_****_

好的，我已经对 `resources/views/products/index.blade.php` 文件进行了修改：

1.  **表格产品列**：为包含产品名称/SKU/条形码的 `<td>` 添加了 `max-w-xs` 和 `truncate` 类，限制其最大宽度并启用文本截断。
2.  **分页样式**：在页面底部通过 `@push('styles')` 添加了 CSS 规则，美化了分页链接的外观，使其具有更清晰的背景、边框和悬停效果。
3.  **搜索/过滤**:
    *   将搜索框和几个下拉选择框包裹在了一个 `<form method="GET">` 中，并为搜索框添加了 `name="search"` 属性。
    *   修改了 `setupProductFiltering()` JavaScript 函数：
        *   添加了获取所有过滤输入框（搜索、分类、状态、库存状态）和产品表格行的逻辑。
        *   实现了 `applyFilters()` 函数，该函数会根据所有选定的过滤器隐藏或显示表格行。
        *   为输入框添加了事件监听器（`input` 或 `change`），以便在用户更改选择时自动调用 `applyFilters()`。
        *   添加了 `console.log` 语句，方便你在浏览器开发者工具中查看过滤过程。
        *   在页面加载时调用 `applyFilters()` 一次，以应用可能存在的初始过滤条件（例如，如果 URL 中已包含过滤参数）。

**请注意：**

*   **前端搜索**: 我添加的 JavaScript 过滤逻辑是**纯前端**的。它只会在当前页面已加载的产品数据中进行过滤。如果你的产品数量很多，导致分页，这个前端搜索**无法**搜索到不在当前页的产品。对于大量数据，通常需要后端搜索（即每次更改筛选条件时都向服务器发送请求，让服务器返回过滤后的数据）。不过，对于中小型列表，或者作为对后端搜索的补充，前端过滤可以提供更快的响应。
*   **错误修复**: 我注意到 `ProductController.php` 中 `edit` 方法的第 281 行有一个错误：`Storage::disk('public')->url($mediaItem->path)`，提示 `Undefined method 'url'`。 这通常意味着你可能需要使用 `Storage::url()` 而不是 `Storage::disk('public')->url()`。或者，如果你的文件本身就在 `public` 目录下且可以直接访问，你可能需要使用 `asset('storage/' . $mediaItem->path)`。请检查你的存储配置和文件结构来修复这个问题。

现在，你可以刷新产品列表页面：

1.  检查搜索框、分类、状态和库存下拉框是否能正常工作，并实时过滤表格中的产品。
2.  检查产品列的宽度是否被限制，长文本是否被截断并显示省略号。
3.  检查分页按钮的样式是否已经更新。
4.  打开浏览器开发者工具（通常按 F12），查看控制台（Console）选项卡，确认是否有 JavaScript 错误，并观察 `console.log` 输出的过滤信息。

---

_**User**_

帮我改成使用后端搜索

---

_**Assistant**_



---

_****_

好的，我们来将产品列表页面的搜索和过滤功能切换到由后端处理。

**计划：**

1.  **修改视图 (`resources/views/products/index.blade.php`)**:
    *   移除之前添加的前端 JavaScript 过滤逻辑（`setupProductFiltering` 函数及其调用）。
    *   确保过滤表单 (`#filter-form`) 的 `method` 是 `GET`，`action` 指向 `products.index` 路由。
    *   为分类、状态、库存状态的 `<select>` 元素添加 `name` 属性，以便它们的值能被提交到后端。
    *   修改 `<select>` 和搜索 `<input>`，使其能够根据请求参数 (`request(...)`) 自动选中或填入之前的值，以便在页面重新加载后保持过滤状态。
    *   添加一个可见的提交按钮，或者移除隐藏的提交按钮并让用户通过按 Enter 键提交表单。我们先添加一个明确的按钮。
2.  **修改控制器 (`app/Http/Controllers/ProductController.php`)**:
    *   在 `index` 方法中，获取新的请求参数：`category_id`, `status`, `stock_status`。
    *   根据这些参数构建数据库查询条件：
        *   `category_id` 的过滤逻辑已存在。
        *   根据 `status` 参数添加对 `is_active` 字段的过滤。
        *   根据 `stock_status` 参数添加对库存相关的过滤 (这可能需要检查 `inventory_count` 和 `min_stock` 字段)。
    *   将这些过滤参数传递回视图，以便在表单中显示当前激活的过滤器。

**步骤：**

1.  **修改视图文件 (`resources/views/products/index.blade.php`)**
    我将移除前端过滤的 JS 代码，并更新表单元素以支持后端过滤。
    

---

_****_

```diff
                      <div>
                          <label for="frontend-category" class="block text-sm font-medium text-gray-700">Category</label>
-                         <select id="frontend-category" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
+                         <select id="frontend-category" name="category_id" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                              <option value="">All Categories</option>
                              @foreach($categories as $category)
-                                 <option value="{{ $category->id }}">
+                                 <option value="{{ $category->id }}" {{ request('category_id') == $category->id ? 'selected' : '' }}>
                                      {{ $category->name }}
                                  </option>
                      <div>
                          <label for="frontend-status" class="block text-sm font-medium text-gray-700">Status</label>
-                         <select id="frontend-status" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
+                         <select id="frontend-status" name="status" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                              <option value="">All Statuses</option>
-                             <option value="1">Active</option>
-                             <option value="0">Inactive</option>
+                             <option value="1" {{ request('status') === '1' ? 'selected' : '' }}>Active</option>
+                             <option value="0" {{ request('status') === '0' ? 'selected' : '' }}>Inactive</option>
                          </select>
                      </div>
                      <div>
                          <label for="frontend-stock-status" class="block text-sm font-medium text-gray-700">Stock Status</label>
-                         <select id="frontend-stock-status" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
+                         <select id="frontend-stock-status" name="stock_status" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                              <option value="">All</option>
-                             <option value="sufficient">Sufficient Stock</option>
-                             <option value="low">Low Stock</option>
-                             <option value="out">Out of Stock</option>
+                             <option value="sufficient" {{ request('stock_status') === 'sufficient' ? 'selected' : '' }}>Sufficient Stock</option>
+                             <option value="low" {{ request('stock_status') === 'low' ? 'selected' : '' }}>Low Stock</option>
+                             <option value="out" {{ request('stock_status') === 'out' ? 'selected' : '' }}>Out of Stock</option>
                          </select>
                      </div>
                  </div>
-                 <button type="submit" class="hidden">Apply Filters</button>
+                 <div class="mt-4 flex justify-end space-x-2">
+                     <a href="{{ route('products.index') }}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
+                         Clear Filters
+                     </a>
+                     <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
+                         Apply Filters
+                     </button>
+                 </div>
              </form>
          </div>
          isInitialized = true;
          
-         console.log('Initializing products page');
-         
-         // 前端筛选
-         setupProductFiltering();
+         console.log('Initializing products page (Backend Filtering Mode)');
          
          // 设置删除按钮事件
          }
      }
-     
-     // 设置产品筛选功能
-     function setupProductFiltering() {
-         // 实现前端筛选
-         console.log('Setting up product filtering. This function needs implementation.');
-         const searchInput = document.getElementById('frontend-search');
-         const categorySelect = document.getElementById('frontend-category');
-         const statusSelect = document.getElementById('frontend-status');
-         const stockSelect = document.getElementById('frontend-stock-status');
-         const tableBody = document.getElementById('products-table-body');
-         const noResultsRow = document.getElementById('no-products-row');
-         const allRows = tableBody ? Array.from(tableBody.querySelectorAll('tr.product-row')) : [];
- 
-         function applyFilters() {
-             const searchTerm = searchInput.value.toLowerCase();
-             const categoryId = categorySelect.value;
-             const status = statusSelect.value;
-             const stockStatus = stockSelect.value;
-             let visibleCount = 0;
- 
-             console.log('Applying filters:', { searchTerm, categoryId, status, stockStatus });
- 
-             allRows.forEach(row => {
-                 const name = row.dataset.name || '';
-                 const sku = row.dataset.sku || '';
-                 const barcode = row.dataset.barcode || '';
-                 const rowCategory = row.dataset.category || '';
-                 const rowStatus = row.dataset.status || '';
-                 const rowStock = row.dataset.stockStatus || '';
- 
-                 const searchMatch = searchTerm === '' || name.includes(searchTerm) || sku.includes(searchTerm) || barcode.includes(searchTerm);
-                 const categoryMatch = categoryId === '' || rowCategory === categoryId;
-                 const statusMatch = status === '' || rowStatus === status;
-                 const stockMatch = stockStatus === '' || rowStock === stockStatus;
- 
-                 if (searchMatch && categoryMatch && statusMatch && stockMatch) {
-                     row.style.display = '';
-                     visibleCount++;
-                 } else {
-                     row.style.display = 'none';
-                 }
-             });
- 
-             if (noResultsRow) {
-                  noResultsRow.style.display = visibleCount === 0 ? '' : 'none';
-             }
-              console.log(`${visibleCount} products visible after filtering.`);
-         }
- 
-         if (searchInput) searchInput.addEventListener('input', applyFilters);
-         if (categorySelect) categorySelect.addEventListener('change', applyFilters);
-         if (statusSelect) statusSelect.addEventListener('change', applyFilters);
-         if (stockSelect) stockSelect.addEventListener('change', applyFilters);
- 
-         // Initial filter application on load if needed
-          applyFilters(); // Apply filters once on page load based on initial values
-     }
      
      // 预加载所有参数组合
```

---

_****_



---



---

