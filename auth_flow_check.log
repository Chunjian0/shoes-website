=== API认证流程检查 [2025-03-20 15:35:38] ===

[2025-03-20 15:35:38] 开始API认证流程测试...
[2025-03-20 15:35:38] 
[测试1] 无认证请求测试
[2025-03-20 15:35:38] 请求端点: http://localhost:2268/api/products
[2025-03-20 15:35:39] 状态码: 401
[2025-03-20 15:35:39] 响应内容: {"status":"error","message":"Unauthorized access"}
[2025-03-20 15:35:39] 认证失败: 需要登录
[2025-03-20 15:35:39] 请求端点: http://localhost:2268/api/user
[2025-03-20 15:35:40] 状态码: 401
[2025-03-20 15:35:40] 响应内容: {"message":"Unauthenticated."}
[2025-03-20 15:35:40] 认证失败: 需要登录
[2025-03-20 15:35:40] 请求端点: http://localhost:2268/sanctum/csrf-cookie
[2025-03-20 15:35:41] 状态码: 204
[2025-03-20 15:35:41] 响应内容: 
[2025-03-20 15:35:41] 请求成功: 无需认证即可访问
[2025-03-20 15:35:41] 
[测试2] Cookie认证流程测试
[2025-03-20 15:35:41] 步骤1: 获取CSRF令牌
[2025-03-20 15:35:42] CSRF请求状态码: 204
[2025-03-20 15:35:42] 获取到XSRF-TOKEN: eyJpdiI6Il...
[2025-03-20 15:35:42] 
步骤2: 尝试登录
[2025-03-20 15:35:42] 登录状态码: 422
[2025-03-20 15:35:42] 登录响应: {"message":"The credentials provided are incorrect.","errors":{"email":["The credentials provided are incorrect."]}}
[2025-03-20 15:35:42] 登录失败, 状态码: 422
[2025-03-20 15:35:42] 错误信息: The credentials provided are incorrect.
[2025-03-20 15:35:42] 
步骤3: 使用Cookie测试API端点
[2025-03-20 15:35:43] 请求端点: http://localhost:2268/api/products
[2025-03-20 15:35:43] 状态码: 401
[2025-03-20 15:35:43] 响应内容: {"status":"error","message":"Unauthorized access"}
[2025-03-20 15:35:43] Cookie认证失败
[2025-03-20 15:35:44] 请求端点: http://localhost:2268/api/user
[2025-03-20 15:35:44] 状态码: 401
[2025-03-20 15:35:44] 响应内容: {"message":"Unauthenticated."}
[2025-03-20 15:35:44] Cookie认证失败
[2025-03-20 15:35:45] 请求端点: http://localhost:2268/sanctum/csrf-cookie
[2025-03-20 15:35:45] 状态码: 204
[2025-03-20 15:35:45] 响应内容: 
[2025-03-20 15:35:45] Cookie认证成功
[2025-03-20 15:35:45] 
[测试3] Bearer令牌认证测试
[2025-03-20 15:35:45] 创建临时令牌生成脚本: create_test_token.php
[2025-03-20 15:35:45] 尝试生成测试令牌...
[2025-03-20 15:35:46] 成功生成令牌: 3|TFd6FCgx...
[2025-03-20 15:35:47] 请求端点: http://localhost:2268/api/products
[2025-03-20 15:35:47] 状态码: 401
[2025-03-20 15:35:47] 响应内容: {"status":"error","message":"Unauthorized access"}
[2025-03-20 15:35:47] Bearer令牌认证失败
[2025-03-20 15:35:47] 请求端点: http://localhost:2268/api/user
[2025-03-20 15:35:48] 状态码: 401
[2025-03-20 15:35:48] 响应内容: {"message":"Unauthenticated."}
[2025-03-20 15:35:48] Bearer令牌认证失败
[2025-03-20 15:35:48] 请求端点: http://localhost:2268/sanctum/csrf-cookie
[2025-03-20 15:35:48] 状态码: 204
[2025-03-20 15:35:48] 响应内容: 
[2025-03-20 15:35:48] Bearer令牌认证成功
[2025-03-20 15:35:48] 
测试完成. 日志文件: auth_flow_check.log
