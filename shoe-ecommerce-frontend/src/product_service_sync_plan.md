# ProductService Sync Plan\n\n## Goal\nSynchronize the logic of `shoe-ecommerce-frontend/src/services/productService.ts` with `shoe-ecommerce-frontend/src/services/productService.js` while maintaining TypeScript best practices and type safety.\n\n## Differences & Decisions\n\n*   **Error Handling/Mock Data**: JS uses mocks, TS throws errors or returns empty defaults. **Decision**: Keep TS approach (no mocks).\n*   **API Calls/Data Structures**: Differences exist. **Decision**: Prioritize TS types/interfaces, reference JS for logic.\n*   **Caching**: Differences exist (e.g., product stock). **Decision**: Align where appropriate (remove stock cache, adjust review cache time).\n*   **Helpers**: `convert*` functions differ. **Decision**: Improve TS helpers based on JS logic while adhering to `Product` type.\n\n## Tasks & Steps\n\n1.  **Analyze Differences**: (DONE)\n2.  **Implement Changes in `productService.ts`**:\n    *   [ ] **`getProductStock`**: Remove `redisService.cacheGetOrSet` wrapper. Call `apiService.products.getStock(id)` directly within the `try` block.\n    *   [ ] **`getProductReviews`**: Change cache duration in `redisService.cacheGetOrSet` from default/current to `900000` (15 minutes).\n    *   [ ] **`addProductReview`**: Modify cache clearing inside the `try` block to only call `await redisService.deletePattern(\`product:\${id}:reviews:*\`);`.\n    *   [ ] **`clearProductCache`**: Replace existing `redisService.delete` calls with:\n        ```typescript\n        await redisService.delete(`product:\${id}`);\n        await redisService.deletePattern(`product:\${id}:*`); // Include reviews, stock etc.\n        ```\n    *   [ ] **`clearCategoriesCache`**: Replace existing `redisService.delete` calls with:\n        ```typescript\n        await redisService.delete('categories');\n        await redisService.deletePattern('category:*');\n        ```\n    *   [ ] **`getStockStatus` Helper**: Add the following function:\n        ```typescript\n        const getStockStatus = (stockQuantity: number | undefined | null): 'in_stock' | 'low_stock' | 'out_of_stock' => {\n            const quantity = stockQuantity ?? 0;\n            if (quantity > 10) return 'in_stock';\n            if (quantity > 0) return 'low_stock';\n            return 'out_of_stock';\n        };\n        ```\n    *   [ ] **`convertTemplateToProducts`**: Update the mapping logic inside the `.map` function:\n        *   Parse `price`: `price: parsePrice(linkedProduct.price ?? template.price ?? 0),`\n        *   Parse `selling_price`: `selling_price: parsePrice(linkedProduct.price ?? template.price ?? 0),`\n        *   Robust image handling (similar to JS version's logic).\n        *   Add `stock`: `stock: linkedProduct.stock_quantity ?? linkedProduct.stock ?? 0,`\n        *   Add `stock_status`: `stock_status: getStockStatus(linkedProduct.stock_quantity ?? linkedProduct.stock),`\n    *   [ ] **`parsePrice` Helper**: Add a helper function to safely parse price values:\n        ```typescript\n        const parsePrice = (price: any): number => {\n          if (typeof price === 'number') return price;\n          if (typeof price === 'string') {\n            const parsed = parseFloat(price);\n            return isNaN(parsed) ? 0 : parsed;\n          }\n          return 0;\n        };\n        ```\n3.  **Review and Test**: Verify changes.\n 