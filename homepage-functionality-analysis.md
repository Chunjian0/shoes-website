# 首页功能分析与计划

## 当前功能分析

根据对`homepage.js`文件的分析，目前的主页管理系统主要分为三个主要功能模块：

1. **特色产品管理** (Featured Products)
2. **新品管理** (New Products)
3. **促销产品管理** (Sale Products)

### 特色产品管理

**当前功能：**
- 可以从所有产品中选择任意产品作为特色产品
- 支持添加、删除特色产品
- 支持更改特色产品的显示图片
- 使用`HomepageController.php`中的`getFeaturedProducts`方法获取特色产品
- 通过`is_featured`字段标记产品是否为特色产品

### 新品管理

**当前功能：**
- 支持显示新品列表
- 支持添加、删除新品
- 支持新品产品搜索和分类筛选
- 获取产品时使用创建日期过滤（默认30天内的产品）
- 使用`ProductController.php`中的`getNewArrivals`方法获取新品

### 促销产品管理

**当前功能：**
- 支持显示促销产品列表
- 支持添加、删除促销产品
- 促销产品仅包含有折扣的产品
- 使用`ProductController.php`中的`getPromotionProducts`方法获取促销产品
- 筛选`discount_percentage > 0`或`show_in_sale = true`的产品

## 不足与缺失功能

根据需求分析，当前系统存在以下不足或缺失的功能：

### 1. 新品自动管理

**缺失功能：**
- 没有设置是否自动将新创建的产品添加到新品展示的选项
- 没有自动移除超过新品展示天数的产品的功能
- 没有设置新品展示天数的选项

### 2. 促销产品自动管理

**缺失功能：**
- 没有自动添加有折扣的产品到促销产品展示的选项
- 没有自动移除折扣过期或折扣为0的产品的功能

### 3. 产品数据加载

**当前状态：**
- 每个产品类型（特色、新品、促销）都有单独的API调用
- 没有一次性加载所有产品然后前端进行过滤的功能

## 需要添加的功能

### 1. 新品自动管理

需要添加以下功能：
- 添加设置新品展示天数的选项（推荐默认为30天）
- 添加自动将新创建的产品添加到新品展示的开关
- 添加自动移除超过新品展示天数的产品的功能
- 定期检查并更新新品状态的后台任务

### 2. 促销产品自动管理

需要添加以下功能：
- 添加自动将有折扣的产品添加到促销产品展示的开关
- 添加自动移除折扣过期或折扣为0的产品的功能
- 定期检查并更新促销产品状态的后台任务

### 3. 优化产品数据加载

需要调整以下功能：
- 实现一次性加载所有产品的API
- 根据不同条件（如是否特色产品、是否新品、是否促销）在前端进行产品过滤
- 提高前端性能，减少API调用次数

## 实施计划

### 阶段1：后端API调整

1. 创建新的设置选项：
   - 新品展示天数
   - 是否自动添加新产品到新品展示
   - 是否自动添加折扣产品到促销展示

2. 修改现有API或创建新API以支持：
   - 一次性获取所有产品，并包含所需的标志（如is_featured, is_new, is_sale）
   - 提供产品的完整信息，包括创建日期、折扣信息等

3. 创建后台任务：
   - 定期检查产品，更新新品状态
   - 定期检查产品，更新促销产品状态

### 阶段2：前端功能实现

1. 修改homepage.js：
   - 实现一次性加载产品数据
   - 根据不同条件进行前端过滤
   - 添加自动管理的开关和选项

2. 添加新的UI元素：
   - 新品自动管理设置
   - 促销产品自动管理设置
   - 新品展示天数设置

### 阶段3：测试与优化

1. 测试功能的正确性
2. 性能测试与优化
3. 用户体验优化

## 总结

当前系统已经实现了产品管理的基本功能，包括特色产品、新品和促销产品的管理。但还需要添加自动管理功能，并优化数据加载方式，以满足一次性加载数据并前端过滤的要求。通过实施上述计划，可以使系统更加智能化，减少手动操作，提高管理效率。 